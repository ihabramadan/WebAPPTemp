<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></meta>
        
        <title>Groups</title>
    </h:head>
    <h:body >


        <div class="col-lg-12">
            <div class="col-lg-6">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        #{msg['groups.add_delete']}
                    </div>
                    <div class="panel-body">






                        <div class="form-group" >

                            <h:message id="addGroupSuccess" for="addGroupSuccess" class="form-control-messages alertLogin alert-success"/>

                        </div>


                        <h:messages id="globalMessaged" rendered="#{facesContext.validationFailed }" layout="table" class="form-control-messages alertLogin alert-danger"/>

                        <div class="form-group" >
                            <h:message id="addGroupError" for="addGroupError" class="form-control-messages alertLogin alert-danger"/>
                        </div>


                        <label >#{msg['groups.group_name']}</label><h:outputText style="color:red" value="*" />
                        <div class="form-group">
                            <h:inputText id="txtGroupName" value="#{groupData.groupName}" class="form-control" required="true" requiredMessage="#{msg['groups.group_name_required']}" ></h:inputText>
                        </div>
                        <label >#{msg['groups.desc']}</label>
                        <div class="form-group">
                            <h:inputText id="txtGroupDesc" value="#{groupData.groupDesc}" class="form-control"  ></h:inputText>
                        </div>
                        <div class="form-group">
                            <h:commandButton  class='btn btn-primary' id="addGroupButton"   onclick="AddGroup()" value="#{msg['groups.add_group']}">
                                <f:ajax  onevent="bindGroups()"  execute="txtGroupName txtGroupDesc" render=" txtGroupName addGroupSuccess   globalMessaged "  /> 
                            </h:commandButton>
                        </div>

                        

                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        #{msg['groups.all_groups']}
                    </div>
                    <div class="panel-body">
                        <h:form id="successGroup">
                            <div class="form-group" >
                                <h:message for="successGroup"    class="form-control-messages alertLogin alert-success"/>
                            </div>
                        </h:form>
                        <h:form id="errorGroup">
                            <div class="form-group" >
                                <h:message for="errorGroup"    class="form-control-messages alertLogin alert-danger"/>
                            </div>
                        </h:form>
                        <h:form>
                            <div class="panel-body">
                                <div class="table-responsive" style="overflow:scroll;height:480px">
                                    <table class="table table-striped table-bordered table-hover" id="dataTables-example">
                                        <thead>
                                            <tr>
                                                <th>#{msg['groups.group_name']}</th>
                                                <th>#{msg['groups.desc']}</th>
                                                <th>#{msg['groups.pages']}</th>
                                                <th>#{msg['groups.delete']}</th>

                                            </tr>
                                        </thead>
                                        <tbody class="groupsList">

                                                    
                                        </tbody>
                                    </table>
                                </div>

                            </div>
                        </h:form>
                    </div>
                </div>
            </div> 
            <ui:include src="groupPagesModal.xhtml"/>
            




        </div>

        <script>
            function AddGroup() {
                if ($('#txtGroupName').val() === "") {
                    
                    $("#addGroupError").text("#{msg['groups.group_name_required']}");
                    $("#addGroupError").css("display", "block");
                    $("#addGroupError").attr("class", "alert alert-danger");
                    $("#addGroupSuccess").css("display", "none");
                    $("#globalMessaged").css("display", "none");
                    return false;
                }
                $.ajax({
                    url: '#{facesContext.externalContext.requestContextPath}/AddGroup',
                    data: {
                        groupName: $('#txtGroupName').val(),
                        groupDesc: $('#txtGroupDesc').val()
                    }
                }).done(function (result) {
                    if (result === "#{msg['groups.group_added']}") {
                        $("#addGroupSuccess").text(result);
                        $("#addGroupSuccess").css("display", "block");
                        $("#addGroupSuccess").attr("class", "alert alert-success");
                        $("#addGroupError").css("display", "none");
                        $('#txtGroupName').val("");
                        $('#txtGroupDesc').val("");
                    }
                    else {
                        $("#addGroupError").text(result);
                        $("#addGroupError").css("display", "block");
                        $("#addGroupError").attr("class", "alert alert-danger");
                    }

                    bindGroups();
                });
            }
            function deleteGroup(id) {

                var $id = id;
                var ok = confirm('#{msg['groups.you_sure']}');
               
                if (ok === false)
                    return;
                $.ajax({
                    url: '#{facesContext.externalContext.requestContextPath}/DeleteGroup',
                    data: {
                        ID: $id
                    }
                }).done(function (msg) {
                    $("#addGroupSuccess ").text('#{msg['groups.deleted']}');
                    $("#addGroupSuccess").css("display", "block");
                    $("#addGroupSuccess").attr("class", "alert alert-success");
                    
                    $("#globalMessaged").css("display", "none");
                    bindGroups();
                    return false;
                });
            }

            function bindGroups() {
                $.ajax({
                    url: '#{facesContext.externalContext.requestContextPath}/GetAllgroups',
                    dataType: 'json'
                }).done(function (result) {

                    var items = result;
                    $('.groupsList').html("");

                    $.each(items, function (i, item) {

                        $('.groupsList').append('<tr> <td> ' + item.groupname + '</td>' + '<td> '
                                + item.groupdesc + '</td> <td><button id="'+ item.id + '" type="button" groupName="'+item.groupname+ '" data-toggle="modal"    onclick="showModal('+item.id+')"  value="' + item.id + '"  class="btn btn-primary">'
                                + '#{msg['groups.pages']}' + '</button></td><td><button id="deleteBtn" type="button"   onclick="deleteGroup( ' + item.id + ')" class="btn btn-danger">'
                                + '#{msg['groups.delete']}' + '</button> </td></tr>');



                    });
                });
            }
            bindGroups();
           
            function getpages(groupId) {
                
                 $.ajax({
                    
                        url: '#{facesContext.externalContext.requestContextPath}/GetGroupPages',
                        data: {
                            groupId: groupId
                            
                        },
                                dataType: 'json'
                    }).done(function (result) {
                      var items = result;
                      var pagesIds = [];
                      $.each(items, function (i, item) {
                          pagesIds.push(item.id);
                      });
                      $("#pagesList").val(pagesIds);
                    });
                
                
            }
            function showModal(gId){
            
                getpages(gId);
                $('#groupPagesModal').modal('show');  
            }

            

        </script>

    </h:body>

</html>

